<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ENIGMA</title>
  <style>
    body {
      background: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      padding: 20px;
      text-align: center;
    }

    .section {
      margin-bottom: 20px;
    }

    input, button {
      padding: 10px;
      margin: 5px;
      font-size: 16px;
      border-radius: 5px;
      border: none;
    }

    input[type="number"] {
      width: 100px;
      background: #1a1a1a;
      color: #fff;
      border: 1px solid #333;
    }

    button {
      background: #444;
      color: #fff;
    }

    .highlight {
      font-size: 18px;
      font-weight: bold;
      margin-top: 10px;
      color: #00bfff;
    }

    .quote-box {
      margin-top: 10px;
      font-style: italic;
      font-size: 15px;
      color: #99f;
    }

    .buttons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    .win-btn { background: #28a745; }
    .loss-btn { background: #dc3545; }
    .undo-btn { background: #ff9900; }

    .bubble-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 6px;
      margin: 15px 0;
    }

    .bubble {
      width: 20px;
      height: 20px;
      border-radius: 50%;
    }

    .win { background: #28a745; }
    .loss { background: #dc3545; }
  </style>
</head>
<body>

<!-- Drawdown Calculator -->
<div class="section">
  <input type="number" id="ib" placeholder="IB">
  <input type="number" id="cb" placeholder="CB">
  <input type="number" id="tad" placeholder="TAD">
  <input type="number" id="riskPercent" placeholder="Risk %" value="10">
</div>

<div class="section highlight" id="riskBox">Current Risk: $0.00</div>
<div class="section" style="font-size: 14px;">Current DD: <span id="ddBox">$0.00</span> | DD Left: <span id="ddLeftBox">$0.00</span></div>

<!-- ENIGMA Simulator -->
<div class="section buttons">
  <button class="win-btn" onclick="logTrade(true)">Win</button>
  <button class="loss-btn" onclick="logTrade(false)">Loss</button>
  <button class="undo-btn" onclick="undoLastTrade()">Undo</button>
</div>

<div class="section" id="streakBox">Streak: 0</div>
<div class="section" id="winRateBox">Win Rate: 0%</div>
<div class="bubble-container" id="bubbleContainer"></div>
<div class="quote-box" id="quoteBox"></div>

<!-- Audio -->
<audio id="winSound" src="https://assets.mixkit.co/sfx/download/mixkit-achievement-bell-600.wav"></audio>
<audio id="lossSound" src="https://assets.mixkit.co/sfx/download/mixkit-wrong-answer-fail-notification-946.wav"></audio>

<script>
  let pnl = 0;
  let ib = 0, cb = 0, tad = 0, riskPercent = 10;
  let winStreak = 0, lossStreak = 0;
  let tradeHistory = [];

  const quoteBox = document.getElementById("quoteBox");
  const quotes = [
    "Focus on process, not outcome.",
    "A single trade means nothing. Series matters.",
    "You can win and still make a bad decision.",
    "Even a perfect setup can lose — that's the game.",
    "Good traders bet probabilities, not certainties.",
    "Discipline over drama.",
    "Probabilities, not predictions.",
    "Success is a curve, not a coin flip.",
    "A trade is a sample, not a signal.",
    "Don't marry your bias — divorce quickly."
  ];

  function updateRisk() {
    ib = parseFloat(document.getElementById("ib").value) || 0;
    cb = parseFloat(document.getElementById("cb").value) || 0;
    tad = parseFloat(document.getElementById("tad").value) || 0;
    riskPercent = parseFloat(document.getElementById("riskPercent").value) || 0;

    const dd = Math.max(ib - cb, 0);
    const ddLeft = Math.max(tad - dd, 0);
    const currentRisk = (cb >= ib ? tad : ddLeft) * (riskPercent / 100);

    document.getElementById("ddBox").textContent = `$${dd.toFixed(2)}`;
    document.getElementById("ddLeftBox").textContent = `$${ddLeft.toFixed(2)}`;
    document.getElementById("riskBox").textContent = `Current Risk: $${currentRisk.toFixed(2)}`;
  }

  function logTrade(win) {
    const r = win ? 2 : -1;
    tradeHistory.push({ win, r });
    pnl += r;
    createBubble(win);
    win ? winStreak++ && (lossStreak = 0) : lossStreak++ && (winStreak = 0);
    document.getElementById(win ? "winSound" : "lossSound").play();
    updateWinRate();
    updateStreak();
    showQuote(win);
  }

  function undoLastTrade() {
    if (!tradeHistory.length) return;
    const last = tradeHistory.pop();
    pnl -= last.r;
    const bubbles = document.querySelectorAll('.bubble');
    if (bubbles.length) bubbles[bubbles.length - 1].remove();
    winStreak = 0;
    lossStreak = 0;
    updateWinRate();
    updateStreak();
    quoteBox.textContent = '';
  }

  function updateWinRate() {
    const wins = tradeHistory.filter(t => t.win).length;
    const total = tradeHistory.length;
    const rate = total ? ((wins / total) * 100).toFixed(1) : 0;
    document.getElementById("winRateBox").textContent = `Win Rate: ${rate}%`;
  }

  function updateStreak() {
    let msg = "Streak: ";
    if (winStreak >= 3) msg += `${winStreak} Wins in a Row!`;
    else if (lossStreak >= 3) msg += `${lossStreak} Losses...`;
    else if (winStreak > 0) msg += `${winStreak} Win`;
    else if (lossStreak > 0) msg += `${lossStreak} Loss`;
    else msg += `0`;
    document.getElementById("streakBox").textContent = msg;
  }

  function createBubble(win) {
    const b = document.createElement("div");
    b.className = `bubble ${win ? 'win' : 'loss'}`;
    document.getElementById("bubbleContainer").appendChild(b);
  }

  function showQuote(win) {
    const q = quotes[Math.floor(Math.random() * quotes.length)];
    quoteBox.textContent = `"${q}"`;
  }

  document.getElementById("ib").addEventListener("input", updateRisk);
  document.getElementById("cb").addEventListener("input", updateRisk);
  document.getElementById("tad").addEventListener("input", updateRisk);
  document.getElementById("riskPercent").addEventListener("input", updateRisk);

  updateRisk();
</script>
</body>
</html>
